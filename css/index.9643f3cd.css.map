{"version":3,"sources":["webpack:///src/src/App.vue"],"names":[],"mappings":"AA0FA,UACA,YACA","file":"index.9643f3cd.css","sourcesContent":["<template>\n    <div id=\"app\">\n        <!-- <button @click=\"scan\">扫一扫</button> -->\n        <div>result: {{ result }}</div>\n        <pre v-if=\"debug\" style=\"text-align: left\">{{ res }}</pre>\n    </div>\n</template>\n\n<script>\nimport wx from 'weixin-js-sdk';\nimport {Dialog} from 'vant';\nfunction getUrlParam(name) {\n    var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)');\n    var r = window.location.search.substr(1).match(reg);\n    if (r != null) return unescape(r[2]);\n    return null;\n}\nexport default {\n    name: 'App',\n    components: {},\n    data() {\n        return {\n            res: {},\n            debug: true,\n            result: '',\n            config: {}\n        };\n    },\n    created() {\n        Dialog.alert({\n            message: '请扫描电池二维码'\n        }).then(() => {\n            this.scan();\n        });\n        this.$request({\n            url: 'aseos/battery/wxsign',\n            data: {\n                url: document.location.href.split('#')[0]\n            }\n        }).then((res) => {\n            this.res = res;\n            let {appId, timestamp, nonceStr, signature} = res;\n            wx.config({\n                debug: this.debug,\n                appId,\n                timestamp,\n                nonceStr,\n                signature,\n                jsApiList: ['checkJsApi', 'scanQRCode']\n            });\n        });\n        // this.sendInfo('sdfsdfsdf');\n        wx.error(function (res) {\n            alert('出错了：' + res.errMsg); //这个地方的好处就是wx.config配置错误，会弹出窗口哪里错误，然后根据微信文档查询即可。\n        });\n\n        wx.ready(() => {\n            Dialog.alert({\n                message: '请扫描电池二维码'\n            }).then(() => {\n                this.scan();\n            });\n        });\n    },\n    methods: {\n        scan() {\n            wx.scanQRCode({\n                needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，\n                scanType: ['qrCode'], // 可以指定扫二维码还是一维码，默认二者都有\n                success: (res) => {\n                    // self.$toast('weixin scanQRCode success', 'success');\n                    this.result = res.resultStr;\n                    this.sendInfo(this.result);\n                }\n            });\n        },\n        sendInfo(str) {\n            this.$request({\n                url: 'aseos/battery/batteryInfo',\n                data: {\n                    sn: getUrlParam('sn'),\n                    str: str\n                }\n            });\n        }\n    }\n};\n</script>\n\n<style>\nhtml body {\n    height: 100vh;\n}\n</style>\n"]}